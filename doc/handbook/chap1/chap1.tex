% Impala Operating System
%
% Copyright (C) 2009 University of Wroclaw. Department of Computer Science
%    http://www.ii.uni.wroc.pl/
% Copyright (C) 2009 Mateusz Kocielski, Artur Koninski, Pawel Wieczorek
%    http://trzask.codepainters.com/impala/trac/
% All rights reserved.
%
% Redistribution and use in source and binary forms, with or without
% modification, are permitted provided that the following conditions
% are met:
% 1. Redistributions of source code must retain the above copyright
%  notice, this list of conditions and the following disclaimer.
% 2. Redistributions in binary form must reproduce the above copyright
%  notice, this list of conditions and the following disclaimer in the
%  documentation and/or other materials provided with the distribution.
%
% THIS SOFTWARE IS PROVIDED BY AUTHOR AND CONTRIBUTORS ``AS IS'' AND
% ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
% IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
% ARE DISCLAIMED.  IN NO EVENT SHALL AUTHOR OR CONTRIBUTORS BE LIABLE
% FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL
% DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS
% OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION)
% HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT
% LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY
% OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF
% SUCH DAMAGE.
%
% $Id$

\chapter{Opis projektu.}

\section{Wstêp.}

System operacyjny Impala zosta³ zrealizowany w~ramach licencjackiego
projektu programistycznego na~Uniwersytecie Wroc³awskim. W~sk³ad
systemu wchodzi j±dro, biblioteka systemowa (jêzyka C), biblioteka w±tków
oraz oprogramowanie. System jest wzorowany na~systemach wywodz±cych siê
z~systemu UNIX i~przeznaczony jest dla~komputerów klasy PC. 

\subsection{Cele i motywacje projektu.}

G³ównym celem i~motywacj± do~powstania projektu by³a chêæ stworzenia systemu
operacyjnego, który stanowi³by pomoc w~nauce ich budowy i~zasad dzia³ania oraz
mechanizmów niskopoziomowych komputera. Projekt mia³ byæ wzorowany na systemach
wywodz±cych siê z~systemu UNIX i~implementowaæ mo¿liwie najwiêcej zgodnie
ze~standardem POSIX. Jako wyznacznik dojrza³o¶ci projektu oraz funkcjonalno¶ci
kodu przyjête zosta³o przeniesienie pow³oki systemowej \texttt{ash}
oraz~edytora tekstu
vi. Projektowany system pomimo, ¿e tworzony wy³±cznie na komputerach klasy PC,
wyposa¿onych w~procesor Pentium Pro,
mia³ byæ mo¿liwie najbardziej przeno¶ny. Dodatkow± motywacj± by³a chêæ
zg³êbienia kodu i mechanizmów dzia³ania popularnych nastêpców systemu UNIX.

Pow³oka \texttt{ash} zosta³a zaprogramowana w~1992 roku przez Kennetha
Almquista
dla~systemu BSD UNIX\footnote{Pow³oka do~dzi¶ jest stosowana w~systemie
FreeBSD jako g³ówna pow³oka systemowa. Niektóre dystrybucje systemu Linux
u¿ywaj± tej pow³oki jako wyznacznik zgodno¶ci skryptów ze standardem,
w~dystrybuowanych paczkach jest dostêpna pod nazw± \texttt{dash}.
}
jako zastêpca oryginalnej pow³oki Bourna. Nie posiada
wielu wygodnych funkcji, jak historia poleceñ i dope³nianie komend,
 dostêpnych w~popularnych pow³okach jak \texttt{bash}, \texttt{tcsh},
\texttt{zsh}, lecz posiada obs³ugê zarz±dzania zadaniami, st±d mo¿na j±
uznaæ za~wyznacznik podobieñstwa do~systemu UNIX.

\subsection{Co uda³o siê osi±gn±æ.}

Zrealizowany projekt z pewno¶ci± stwarza mo¿liwo¶æ zg³êbienia tajników
budowy i zasad dzia³ania systemu operacyjnego, wszystkie wa¿ne mechanizmy
zosta³y zaprojektowane, zaimplementowane i omówione w tej dokumentacji.
Za³o¿enie o przeno¶no¶ci systemu zosta³o zrealizowane poprzez oddzielenie kodu
dzia³aj±cego na poziomie sprzêtu i operuj±cego bezpo¶rednio na nim od kodu
dzia³aj±cego niezale¿nie od platformy. Podej¶cie to umo¿liwia studiowanie
mechanizmów niskopoziomowych niezale¿nie od reszty systemu. Uda³o siê
zrealizowaæ za³o¿enie podobieñstwa do~systemu UNIX,
czego konsekwencj± jest przeniesienie z powodzeniem pow³oki systemowej \texttt{ash},
nie zosta³ jednak zrealizowany cel przeniesienia edytora tekstowego, który
wymaga dalszego dostosowania.
Uda³o siê równie¿ przenie¶æ program \texttt{vttest}, który pos³u¿y³ przy
sprawdzaniu i~udoskanalaniu naszej implementacji terminali w~emulacji VT100.

Poniewa¿ pow³oka systemowa zosta³a zaprojektowana dla~systemu BSD to~podczas
rozwijania naszego systemu by by³ w~stanie uruchomiæ ten program mogli¶my
odbiec od~semantyki procedur systemowej ze standardu POSIX, na~rzecz systemu
docelowego pow³oki. Stwierdzenie zgodno¶ci ze~standardem wymaga przeprowadzenia
testów.

\section{Organizacja.}

\subsection{U¿yte narzêdzia.}

Realizacja projektu wymaga³a u¿ycia wielu narzêdzi dostarczonych z zewn±trz.
Poni¿ej znajduje siê zwiêz³y opis tych, które odegra³y kluczow± rolê
podczas pracy.

Zarz±dzanie prac± grupow± i podzia³ zadañ na poszczególnych programistów
by³o wspomagane przez system EdgeWall
Trac\footnote{Instalacja tego programu na~potrzeby naszego projektu jest dostêpna
pod adresem internetowym \texttt{http://trzask.codepainters.com/impala/trac/} },
kolejne etapy projektu zosta³y podzielone na mniejsze
zadania i wprowadzone jako bilety, dziêki wykorzystaniu tego mechanizmu mo¿liwa
by³a na bie¿±co kontrola efektów pracy i planowanie kolejnych etapów rozwoju.
Wykorzystane zosta³y równie¿ mechanizmy zarz±dzania tre¶ci± do budowania
zal±¿ków dokumentacji oraz wymiany najistotniejszych informacji o projekcie.
Interfejs dodatkowo stanowi³ graficzn± nak³adkê na system kontroli wersji pozwalaj±c 
wygodnie przegl±daæ kolejne rewizje kodu, udostêpniony mechanizm wiki
umo¿liwi³ równie¿ robienie krótkich notek na~stronie dotycz±cych projektu.


System kontroli wersji SVN zosta³ wykorzystany do synchronizacji kodu, umo¿liwi³
on niezale¿n± i wygodn± pracê nad projektem ka¿demu z uczestników. Wykorzystane
zosta³y mechanizmy ga³êzi do rozwijania wiêkszych mechanizmów, które nastêpnie
by³y scalane do g³ównego drzewa. System pozwoli³ na bie¿±co ¶ledziæ zmiany w
kodzie wprowadzane przy kolejnych rewizjach.

Emulatory komputerów PC, Qemu oraz BOCHS, pozwoli³y na wygodne testowanie
pisanego kodu, dziêki tym programom nie istnia³a potrzeba ci±g³ych restartów
komputera w celu sprawdzenia czy wprowadzane do systemu zmiany przynios³y
oczekiwany skutek. Zosta³o jednak uznane za sprawê wa¿n±, aby system dzia³a³
tak¿e na prawdziwych komputerach klasy PC, po dodaniu istotnych czê¶ci systemu
by³ wiêc testowany i dostosowywany tak, aby dzia³a³ na prawdziwym sprzêcie.
Emulator Qemu dodatkowo pos³u¿y³ do wpiêcia debuggera gdb, co umo¿liwia³o
prostsze wy³apywanie b³êdów oraz ¶ledzenie przebiegu programu. Do obydwu
emulatorów wraz z~projektem dostarczone s± proste ³aty wype³niaj±ce bajty
pamiêci komputera wzorcem \texttt{0xe9}, które pozwalaj± wykryæ wiêcej b³êdów
z~u¿yciem emulatorów, domy¶lnie zeruj±cych pamiêæ RAM.


\subsection{Opis drzewa z~kodem ¼ród³owym.}

Drzewo z~kodem ¼ród³owym ma ustalon± strukturê, w~poni¿szym opisie
katalog \texttt{.} oznacza korzeñ drzewa.

\begin{itemize}
\item \texttt{./doc/doxygen/} - 
katalog z~dokumentacj± kodu automatycznie
generowan± przez program DoxyGen (po~wykonaniu polecenia
\texttt{make doc} w~katalogu wy¿szym).

\item \texttt{./doc/handbook/} -
¼ród³a tego dokumentu.

\item \texttt{./sys/} -
drzewo z~kodem j±dra systemu.

\item \texttt{./sys/arch/} -
drzewo z~wydzielon± obs³ug± platform

\item \texttt{./sys/arch/x86/} -
kod obs³ugi platformy PC z~procesorem PentiumPro.

\item \texttt{./sys/dev/} -
biblioteka \texttt{libdev.a} zawieraj±ca sterowniki urz±dzeñ.

\item \texttt{./sys/fs/} -
biblioteka \texttt{libfs.a} zawieraj±ca obs³ugê systemów plików.

\item \texttt{./sys/kern/} -
kod w³a¶ciwy j±dra.

\item \texttt{./sys/kern/sc/} -
obs³uga wywo³añ systemowych.

\item \texttt{./sys/sys/}
nag³ówki jêzyka C.

\item \texttt{./usr/} -
drzewo z~kodem programów i~bibliotek.

\item \texttt{./usr/bin/} -
¼ród³a standardowych programów.

\item \texttt{./usr/sbin/} -
¼ród³a systemowych programów.

\item \texttt{./usr/demos/} -
¼ród³a programów demonstracyjnych.

\item \texttt{./usr/lib/} -
poddrzewo zawieraj±ce kody bibliotek.

\item \texttt{./usr/lib/libc/} -
biblioteka systemowa (jêzyka C).

\item \texttt{./usr/lib/libpthread/} -
biblioteka w±tków u¿ytkownika.

\item \texttt{./usr/etc/} -
katalog ze skryptami startowymi systemu.

\item \texttt{./mk/} -
skrypty dla programów Makefile tworz±ce nasz system budowania.

\item \texttt{./image/} -
skrypty buduj±ce obraz dyskietki.

\end{itemize}
